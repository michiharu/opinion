---
slug: keep-your-application-code-simple
title: アプリケーションコードをシンプルに
authors: [michiharu]
tags: [dev, simple, kiss]
---

シンプルさについて語るときに僕の語ること、というテーマでいくつか記事を書きたいと思います。

## アプリケーションコードをシンプルに

私のアプリケーションの見方としては「データを表示する」というごく当たり前の機能の実現に8~9割程度のコードが書かれており、
アプリケーション固有のロジックは2割にも満たない、と思っています。

そして多くのフレームワークがよりストレスなく少ないコードでそれらのコードが削減できるように試行錯誤しています。

また残りの2割のロジックも、きちんと設計を決めて書かないとどんどん散らばって書かれだんだんと苦労することになります。
フレームワークは「そのコードはここに書いてくださいね」という規約を持っており、
その規約に縛られながら開発することで、その規約を知る誰にとっても読みやすいコードとなります。


### レイヤーの統合でコードを削る

いろいろなレイヤーの登場するAWSを利用したSPA構成について書いてみます。

- フロント(React, Vue, Svelte)
- アプリケーション層
- DTO層
- DB(RDB, NoSQL)

平凡な構成を意識しましたが、
以下で紹介するフレームワークたちはこれらの層を統合して開発効率を上げています。

#### Next, Nuxt, Remix

これらのフレームワークはフロントからサーバー側のアプリケーションまでを
ひとつのReact(あるいはVue)プロジェクトとして記述出来るようにしたソリューションです。

APIを設計して「こっちからこれを送って、こっちで受け取って」ということを考える必要がありません。

ちなみにサーバーサイドレンダリング、SSRというとちょっとかっこいいですが、昔のWEBアプリの構成は全部SSRでした。
ただしコンポーネント志向といった考え方によってレンダリングを記述するための方法が洗練されましたし、
フロント・サーバー連携によって表示速度は最適化され、ハイドレーションによってSPAと変わらない書き方でインタラクションを実現します。

#### Blitz.js = Next + Prisma

>
“Zero-API” data layer lets you import server code directly into your React components
instead of having to manually add API endpoints and do client-side fetching and caching.

Nextをベースに、PrismaというORMを活用してデータアクセスについてのレイヤーも取り除いてしまおうという、
かなり野心的なフレームワークです。

ここまではフロントとサーバー側のアプリケーション層を統合するソリューションを列挙しました。
そのため使用言語はTypeScript一択ですね。

#### GraphQL(Apollo, Hasura, AppSync)

GraphqlはSchema定義をベースにDBのテーブルとそこへアクセスするために必要なAPIをまとめて準備してしまいます。
自動で準備されるAPIは単純なものに限りますが、カスタムな処理を実施するためのAPIももちろん追加できます。

GraphQLについては業務でも使用したことがあります。確かにかなり管理が必要なコードが減り、
テーブルへのアクセス制限などもディレクティブによって宣言的に記述出来るため、可読性に優れます。

### Railsの思想に学ぶシンプル 

Railsは成熟しているWEBフレームワークのひとつですが、
WEBフレームワークによる開発には多くのメリットがあります。

[Railsの基本理念 : Railsの生みの親が掲げる8つの原則](https://postd.cc/rails-doctrine/#omakase)

今回は「シンプル」という文脈で紹介するにあたり、以下をピックしたいと思います。

>
Railsの生産性に関する初期のモットーは、”君は美しい唯一無二の雪の結晶というわけではない”でした。
これは、無駄な個人プレーをやめれば、平凡な決断で苦労することなく、重要な場面で仕事のスピードが増す、
ということを言っています。

>
メニューは”おまかせ”で
レストランに行ってどれがおいしいのか分からない時ってありますよね。
何が”いい料理”なのか理解すらしていなくても、
そのレストランのシェフに選んでもらえばおいしいものを食べることができるでしょう。
これが”おまかせ”です。
おししいものを選ぶのに、料理のエキスパートになる必要はありませんし、
運に任せてメニューから料理を選ぶ必要もないのです。

Railsはフレームワークを提供しているのですから、それらは"おまかせ"であるわけですね。

デフォルトで何か良いかを教えてくれる、何か難しい問題にぶつかったのなら、その時にデフォルトを他のものに交換出来る。
そういった存在はありがたいものです。

不運にも信頼できるフレームワークが無い環境においても、
この思想がチームで共有出来ているのなら、「方針を決めてから進む（個人プレーはしない）」ことで、
シンプルさを保つことが出来るはずです。

## さいごに

シンプルさについて考えることを全部書いたら、シンプルには見えないボリュームになってしまいました。

今回記事を書きながらたくさんのことを改めて調べて、
やはりUNIXやRailsの思想にはよく練られた英知が凝縮されれていると感じます。

美しいと思えるコードが書きたい、そして仕事はすぐ終わらせたい。
そのどちらもシンプルさが鍵となると信じています。

「小さいこと、選択肢が少ないこと」などがシンプルさを生みます。
私のイメージするシンプルのイメージは伝わったでしょうか。

もし共感してもらえたら仲間ですね。

[SQL直書き派ですがURL]: https://jp.quora.com/SQL%E7%9B%B4%E6%9B%B8%E3%81%8D%E6%B4%BE%E3%81%A7%E3%81%99%E3%81%8C-%E3%83%95%E3%83%AC%E3%83%BC%E3%83%A0%E3%83%AF%E3%83%BC%E3%82%AF%E5%85%A8%E7%9B%9B%E3%81%A7SQL%E7%9B%B4%E6%9B%B8%E3%81%8D%E3%81%97%E3%81%A6%E3%81%84
[ベテランエンジニアはURL]: https://jp.quora.com/%E3%83%99%E3%83%86%E3%83%A9%E3%83%B3%E3%82%A8%E3%83%B3%E3%82%B8%E3%83%8B%E3%82%A2%E3%81%AF-%E5%AE%9F%E8%A1%8C%E3%81%95%E3%82%8C%E3%82%8BSQL%E3%81%8C%E3%83%96%E3%83%A9%E3%83%83%E3%82%AF%E3%83%9C%E3%83%83%E3%82%AF
